@page "/change-data-set"
@attribute [Authorize(Roles = "sales, admin")]

@using Microsoft.AspNetCore.Hosting

@inject IWebHostEnvironment Environment
@inject IJSRuntime JS
@inject IBasicDataSetService dataSetService
@inject IFieldService fieldService
@inject IRoleService roleService
@inject ILanguageService langService
@inject ISkillService skillService




<div class="card my-1">
    <div class="card-header text-center" style="position: relative">

        <h3 style="text-align: center">Datenbasis bearbeiten</h3>
    </div>



</div>


<ul class="alert alert-danger" role="alert">
    @foreach (string line in changeInfo.ErrorMessages)
    {
        <li>
            <pre>@line</pre>
        </li>
    }
</ul>
<ul class="alert alert-info" role="alert">
    @foreach (string line in changeInfo.InfoMessages)
    {
        <li>
            <pre>@line</pre>
        </li>
    }
</ul>
<div class="alert alert-success" role="alert">
    @changeInfo?.SuccesMessage
</div>
<div class="row gutters-sm">

    <div class="col-sm-6 mb-3" style="min-height: 200px;">

        <div class="pb-5">
            <CollapsibleCard CardHeaderTitle="Branchen" ShowCardBody="true">
                <CardBody>
                    @foreach (var field in fieldService.GetAllFields())
                    {

                        <div style="display:inline-block; margin-right:12px">
                            <div style="margin-left: 3px; margin-top: 3px; display:inline-block">
                                <button class="btn btn-outline-primary btn-sm" disabled>@field </button>
                                <button type="button" class="btn btn-light btn-sm" @onclick="@(e => RemoveField(field) )">
                                    <span class="oi oi-minus"></span>
                                </button>
                            </div>
                        </div>


                    }
                    <br />
                    <br>
                    <input class="form-control" id="newField" style="display: inline-block; width: 60%;margin-left: 3px; margin-right: 3px;" @bind="@newField">
                    <button class="btn btn-sm btn-secondary" style="margin-bottom: 3px;" @onclick="CreateField">Branche hinzufügen</button>
                    <br>
                    <br />


                </CardBody>
            </CollapsibleCard>

        </div>
    </div>
    <div class="col-sm-6 mb-3" style="min-height: 200px;">
        <CollapsibleCard CardHeaderTitle="Rollen" ShowCardBody="true">
            <CardBody>
                <div class="row">
                    @foreach (var role in newRoles.GroupBy(x => x.Name))
                    {
                        <div class="col-4" style="text-align:center">
                            <b style="width: 80%; color: #7A212E;text-align: left; font-size: 1rem;">@role.Key</b>
                            <br />
                            @foreach (var r in role)
                            {
                                if (r.Wage != 0)
                                {
                                    <p>
                                        <b>RCL @r.RCL</b>
                                        <input class="form-control" id="inputExpir" style="width: 55px; display: inline;" @bind="@r.Wage">
                                        <span style="margin-left: 3px;">&euro;</span><br>
                                    </p>
                                }
                            }
                        </div>
                    }

                    <br><br>


                </div>
                <button class="btn btn-sm btn-secondary" style="margin-left: 3px;" @onclick="UpdateRoles">Löhne aktuallisieren</button>
                <br>
                <br>

            </CardBody>
        </CollapsibleCard>
    </div>

    <div class="col-sm-6 mb-3" style="min-height: 200px;">

        <div class="pb-5">
            <CollapsibleCard CardHeaderTitle="Sprachen" ShowCardBody="true">
                <CardBody>
                    @foreach (var lang in langService.GetAllLanguages())
                    {
                        <div style="display:inline-block; margin-right:12px">
                            <div style="margin-left: 3px; margin-top: 3px; display:inline-block">
                                <button class="btn btn-outline-primary btn-sm" disabled>@lang.Name </button>
                                <button type="button" class="btn btn-light btn-sm" @onclick="@(e => RemoveLang(lang) )">
                                    <span class="oi oi-minus"></span>
                                </button>
                            </div>
                        </div>

                    }
                    <br>
                    <br>
                    <input class="form-control" id="newLang" style="display: inline-block; width: 60%;margin-left: 3px; margin-right: 3px;" @bind="@newLang">
                    <button class="btn btn-sm btn-secondary" style="margin-bottom: 3px;" @onclick="CreateLang">Sprache hinzufügen</button>
                    <br>
                    <div class="row">
                        <div class="wrap-collabsible ml-3">

                            <input id="collapsible" class="toggle" type="checkbox">
                            <label for="collapsible" class="lbl-toggle" style="margin-bottom:0; width: 95.5%; margin-left: 3px;">
                                <tag>Sprachlevel hinzufügen</tag>
                            </label>

                            <div class="collapsible-content" style="width: 95.5%; margin-left: 3px;">
                                <div class="row ml-1">
                                    <div class="col-4">
                                        <label for="splvl">Level</label><br>
                                        <input class="form-control" placeholder="Titel" id="splvl" @bind="@lvlVal" /><br>
                                    </div>
                                    <div class="col-4">
                                        <label>Position:</label><br>
                                        <select class="form-control" style="width: 150px;" @bind="@lvlInt">
                                            @{
                                                var langLvl = langService.GetAllLevel().Append("").ToArray();
                                                <option value="0">/@langLvl[0]</option>
                                                for (int i = 0; i < langLvl.Length - 1; i++)
                                                {
                                                    <option value="@(i+1)"> @langLvl[i]/ @langLvl[i + 1]</option>
                                                }
                                            }
                                        </select>
                                        <br>
                                    </div>
                                    <div class="col-4">
                                        <br />
                                        <button class="btn btn-sm btn-secondary" style="margin-top: 10px;" @onclick="IsertLvl">Level hinzufügen</button>
                                        <br>


                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <br>

                </CardBody>
            </CollapsibleCard>
        </div>
    </div>
    <div class="col-sm-6 mb-3" style="min-height: 200px;">
        <CollapsibleCard CardHeaderTitle="Skills" ShowCardBody="true">
            <CardBody>


                <tag class="ml-2" style="font-size: 1.3rem;">Skills entfernen:</tag>
                <br>

                <input class="form-control" id="skillRemo" placeholder="Skillsuche" style="margin-left: 3px; width: 98%" @bind="@skillRemo" @bind:event="oninput" />
                @if (skillRemo != "")
                {
                    foreach (var skill in skillService.GetAllSkills().Where(x => x.Name.ToLower().StartsWith(skillRemo.ToLower())))
                    {

                        <div style="display:inline-block; margin-right:12px">
                            <div style="margin-left: 3px; margin-top: 3px; display:inline-block">
                                <button class="btn btn-outline-primary btn-sm" disabled>@skill.Name </button>
                                <button type="button" class="btn btn-light btn-sm" @onclick="@(e => RemoveSkill(skill) )">
                                    <span class="oi oi-minus"></span>
                                </button>
                            </div>
                        </div>

                        <!--<button class="btn btn-outline-primary btn-sm" disabled>@skill.Name </button>
                        <button type="button" class="btn btn-light btn-sm" @onclick="@(e => RemoveSkill(skill) )" style="margin-right: 15px; margin-bottom: 5px">
                            <span class="oi oi-minus"></span>
                        </button>-->

                    }
                }

                <br>

                <tag class="ml-2" style="font-size: 1.3rem;">aktuelle Skilllevel:</tag>
                <br>
                <input id="lvl1" @bind="@skillLevel[0]" class="form-control" style="display: inline-block; margin-left: 3px; width: 49%">
                <input id="lvl2" @bind="@skillLevel[1]" class="form-control" style="display: inline; width: 49%">
                <input id="lvl3" @bind="@skillLevel[2]" class="form-control" style="display: inline-block; margin-left: 3px; margin-top: 3px; width: 49%">
                <input id="lvl4" @bind="@skillLevel[3]" class="form-control" style="display: inline; width: 49%; margin-top: 3px;">
                <button class="btn btn-sm btn-secondary mt-6" style="margin-top: 6px; margin-left: 3px;" @onclick="UpdateSkillLevels">
                    Skilllevel aktualisieren
                </button>

                <br>
                <br>

                <div class="row">
                    <div class="wrap-collabsible2 ml-3">
                        <input id="collapsible2" class="toggle2" type="checkbox">
                        <label for="collapsible2" class="lbl-toggle2" style="margin-bottom: 0; width: 95.5%; margin-left: 3px;">
                            <tag>Skill hinzufügen</tag>

                        </label>

                        <div class="collapsible-content2" style="width: 95.5%; margin-left: 3px;">
                            <div class="row ml-1">
                                <div class="col-4">
                                    <label for="splvl">Skill</label><br>
                                    <input class="form-control" placeholder="Name" id="name" @bind="@newSkill" /><br>
                                </div>
                                <div class="col-4">
                                    <label>Kategorie:</label><br>
                                    <select class="form-control" style="width: 155px;" @bind="@skillCat">
                                        @{
                                            var cats = skillService.GetAllSkills().Select(x => x.Category).Distinct();
                                            @foreach (var cat in cats)
                                            {
                                                <option value="@cat.Name"> @cat.Name</option>
                                            }
                                        }
                                    </select>
                                    <br>
                                </div>
                                <div class="col-4">
                                    <br />
                                    <button class="btn btn-sm btn-secondary" style="margin-top: 10px;" @onclick="CreateSkill">Skill hinzufügen</button>
                                    <br>
                                </div>

                                <!--<div class="col-3">
                                    <input id="name" @bind="@newSkill" placeholder="Name" class="form-control" style="margin-left: 3px;" />
                                </div>
                                <div class="col-3">
                                    <span style="margin-top:5px;"> in der Kategorie</span>
                                </div>
                                <div class="col-3">
                                    <select style="width: 170px;  font-size: 1.1rem;" @bind="@skillCat" class="form-control">
                                        @{
                                            var cats = skillService.GetAllSkills().Select(x => x.Category).Distinct();
                                            @foreach (var cat in cats)
                                            {
                                                <option value="@cat.Name"> @cat.Name</option>
                                            }
                                        }
                                    </select>
                                </div>
                                <div class="col-3">
                                    <button class="btn btn-sm btn-secondary" @onclick="CreateSkill" style="margin-top:8px; margin-left:5px;">hinzufügen</button><br>
                                </div>-->
                            </div>
                            <br>
                        </div>
                        <br>
                        <br>
                    </div>
                </div>



            </CardBody>
        </CollapsibleCard>
    </div>
</div>
<br>
<br>
